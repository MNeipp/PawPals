{% extends 'adopt/base3.html' %}

{% block content %}

<nav class="navbar navbar-expand-lg navbar-light bg-info">
    <a class="nav-link" href="#"></a>
    <div class="collapse navbar-collapse" id="navbarNav">
    </div>
    <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav mr-auto">
        </ul>
        <div class="navbar-nav ml-auto mr-5">
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="true">Sort By</a>
                    <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="{% url 'search' %}?{{path}}&sort=recent">Newest</a>
                    <a class="dropdown-item" href="{% url 'search' %}?{{path}}&sort=-recent">Oldest</a>
                    <a class="dropdown-item" href="{% url 'search' %}?{{path}}&sort=distance">Distance: Nearest</a>
                    <a class="dropdown-item" href="{% url 'search' %}?{{path}}&sort=-distance">Distance: Furthest</a>
                </li>
            </ul>
        </div>
    </div>
</nav>


<div class="container" id="favorites">
    <br>
    <h4 class="text-center type">Favorites</h4>
    <br>

    <div class="row infinite-container">
        {% for dog in dogs %}
        <div class="col-sm-4 mb-2 infinite-item">
            <div class="card text-center">
                {% if dog.id in faves %}
                <a href="{% url 'remove_favorite' dog.id %}" class="badge badge-light align-self-end mr-2" alt_href="{% url 'add_favorite' dog.id %}"><i class='fas fa-heart' style="font-size: x-large; color:crimson;" alt_class='far fa-heart' ></i></a> 
                {% else %}
                <a href="{% url 'add_favorite' dog.id %}" class="badge badge-light align-self-end mr-2" alt_href="{% url 'remove_favorite' dog.id %}"><i class='far fa-heart' style="font-size: x-large; color:crimson;" alt_class="fas fa-heart"></i></a> 
                {% endif %}
                    {% if not dog.photos.0.medium %}
                    <img class="card-img-top" src="/static/adopt/images/grey_no_photo.png" alt="Card image cap" style="object-fit: contain; height:200px">
                    {% else %}
                    <img class="card-img-top" src="{{dog.photos.0.medium}}" alt="A photo of {{dog.name|title}}" style="object-fit: cover; height:300px">
                    {% endif %}
                <div class="card-body">
                    <h5 class="card-title">{{dog.name|title}}</h5>
                    <p class="card-text">{{dog.age}} | {{dog.breeds.primary}}</p>
                    <p class="card-text">{{dog.contact.address.city|title}}</p>
                    <a href="{% url 'pet_detail' dog.id %}" class="btn btn-primary">MEET {{dog.name|upper}}</a>
                </div>
            </div>
        </div>
        {% endfor %}
    {% if dogs.has_next %}
    <a href="{% url 'search' %}?{{path}}&page={{dogs.next_page_number }}" class="infinite-more-link" style="display:none"></a>
    {% endif %}
    </div>
    <div class="d-flex justify-content-center">
        <div class="spinner-border" role="status" style="display:none;">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="{% static '/adopt/js/jquery.waypoints.min.js' %}"></script>
<script src="{% static '/adopt/js/infinite.min.js' %}"></script>

<!-- Infinite Scrolling Script  -->
<script>
    var infinite = new Waypoint.Infinite({
        element: $('.infinite-container')[0],
        handler: function(direction) {

    },
    offset: 'bottom-in-view',

    onBeforePageLoad: function () {
    $('.spinner-border').show();
    },
    onAfterPageLoad: function () {
    $('.spinner-border').hide();
    }

    });
</script>
<!-- Replaces broken images with static image -->
<script>
    fixBrokenImages = function(url){
    var img = document.getElementsByTagName('img');
    var i=0, l=img.length;
    for(;i<l;i++){
        var t = img[i];
        if(t.naturalWidth === 0){
            //this image is broken
            t.src = url;
        }
    }
}

    window.onload = function() {
        fixBrokenImages('../static/adopt/images/grey_no_photo.png');
    }
</script>

<script>
    // like/unlike doggos
    $('#doggos').on('click','.badge', function(e){
        e.preventDefault();
        $.ajax({
            method: 'GET',
            url: $(this).attr('href')
        });
        alt_href = $(this).attr('alt_href');
        href = $(this).attr('href');
        $(this).attr('href', alt_href);
        $(this).attr('alt_href', href);
        alt_class = $(this).children().attr('alt_class');
        _class = $(this).children().attr('class');
        $(this).children().attr('class', alt_class);
        $(this).children().attr('alt_class', _class);
    })
    
    
    
    </script>

{% endblock %}